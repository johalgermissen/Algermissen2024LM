# README General

## Content ##

This collection contains the following files:
- **analyses**: scripts for all behavioral and questionnaire data required to reproduce the reported results.
- **task**: scripts and files for running the task.

Code for the entire paper will be maintained under https://github.com/johalgermissen/Algermissen2024LM, with a permanent copy of the code at the time of publication under https://github.com/denoudenlab/Algermissen2024LM.

**(Raw data and processed data** for this project are available under https://doi.org/10.34973/y3kc-fk40 under a CC-BY-4.0 licence.

## Root directory ##

Note that the **root directory** of this project needs to be adjusted inside analyses/regression/helpers/set_dirs.R and analyses/stan_scripts/helpers/set_dirs_stan.R. 

## Analyses folder ##

### Analysis software used ###
All analyses were performed in _R_. See the file _/analyses/regression/helpers/package_manager.R_ for all respective package version numbers and a print out of both _sessionInfo()_ and _loadedNamespaces()_.

### regression ###
Scripts for plots and fitting linear and additive mixed-effects models.

#### helpers ####
- *package_manager.R*: Loads packages. Also contains version numbers and print-outs of _sessionInfo()_ and _loadedNamespaces()_), set _scipen_ and _factor codings_.
- *set_dirs.R*: Set directories for code and data. Mind adjusting the root directory to your file structure.

#### functions ####
Contains functions common to preprocessing and analyzing behavioral and questionnaire data.

- *00_mgngstakes_functions_regression.R*: Contains several functions for pre-processing behavioral and questionnaire data and fitting linear and additive mixed-effects models (called by *01_mgngstakes_hypotheses.R*, *02_mgngstakes_plot.R*, *02_mgngstakes_regression.R*, *03_mgngstakes_gamm.R*, *04_mgngstakes_questionnaires.R*, , *06_mgngstakes_plots_final.R*).

#### main scripts ####
Contains scripts to analyzing behavioral and questionnaire data . Run files in numerical order:

- *01_mgngstakes_preprocess_hyptheses.R*: Plot hypotheses given bias-strengthening (H1) and expected-value-of-control (EVC; H2) hypotheses.
- *02_mgngstakes_plot.R*: Create raw data plots of responses, and RTs.
- *02_mgngstakes_regression.R*: Fit mixed-effects linear/ logistic regression models to responses and RTs.
- *03_mgngstakes_gamm.R*: Fit generalized additive mixed effects models (GAMMs) to RTs.
- *04_mgngstakes_questionnaires.R*: Correlate regression coefficients from linear mixed-effects models with questionnaire scores.
- *05_mgngstakes_power.R*: Estimate post-hoc power based on the ICC estimated from intercept-only models on responses and RTs.
- *06_mgngstakes_plots_final.R*: Create final plots used in manuscript.

### stan_scripts ###
Scripts for fitting reinforcement-learning drift-diffusion (RL-DDM) models to responses and RTs using rstan in R.

#### main script ####
* *fit_stan_main.R*: fit hierarchical RL-DDM models (multiple subjects) to empirical data.

#### evaluate_fit ####
* *evaluate_fit_short.R*: Evaluate single model: inspect fit indices, convergence criteria, trace plots, posterior densities, parameter intercorrelations across samples, auto-correlation.
* *loop_eval.R*: Loop over fitted models, extract fit indices and convergence criteria.
* *plots_fit_param.R*: Create plots of group-level and subject-level parameter densities and fit indices.

#### helpers ####
- *custom_plots_stan.R*: Functions for plotting group-level and subject-level posterior parameter densities and fit indices from fitted models.
- *fitmodel.R*: sub-routine for fitting model in rstan: Load input data, select names of input and output parameters, load initial parameter values, fit model in rstan, save.
- *initVals4stan_sepParam.R*: initial parameter values for fitting hierarchical model (several subjects) in rstan.
- *initVals4stan_sepParam_flat.R*: initial parameter values for fitting flat model (single subject) in rstan.
- *prepObs4stan.R*: Load raw behavioral data, re-format and save as list as input for fitting models in rstan.
- *set_dirs_stan.R*: Set directories for code and data. Mind adjusting the root directory to your file structure.
* *stan_utlity.R*: code by Michael Bettencourt for evaluating divergence transitions, tree depths, energy Bayesian fraction of missing information (E-BFMI).

#### model_recovery ####
* *eval_model_recovery.R*: Evaluate model recovery: for each simulated data set, find best fitting model, count how often each model Y fits best for the data sets generated by model X, plot confusion matrix. 
* *run_model_recovery_fit.R*: Perform model recovery part B: Load simulated data sets, fit flat models to simulated data sets.
* *run_model_recovery_simulate.R*: Perform model recovery part A: Load fitted hierarchical model; extract subject-level parameters and fit multivariate normal to them; sample new parameters; simulate new data sets (single subject); save sampled parameters and simulated data sets.

#### models ####
* *RLDDM4stan_sepParam.R*: stan code (strings in R) for fitting hierarchical RL-DDM models (multiple subjects) in rstan.
* *RLDDM4stan_sepParam_flat.R*: stan code (strings in R) for fitting flat RL-DDM models (single subject) in rstan.

#### parameter_recovery ####
* *eval_parameter_recovery.R*: Evaluate parameter recovery: evaluate fits to simulated data sets, plot generative against fitted parameters.
* *run_parameter_recovery.R*: Perform parameter recovery: Load fitted hierarchical model; extract subject-level parameters and fit multivariate normal to them; sample new parameters; simulate new data sets (single subject); fit flat models to simulated data sets.
* *test_parameter_recovery.R*: Test whether code for simulating single data set and fitting flat model to it runs.

#### posterior_predictive_checks ####
* *posterior_predictive_checks.R*: Load simulated data sets, average over iterations, plot as function of task factors; compare empirical and simulated data.

#### prior_predictive checks ####
* *simulate_priors.R*: simulate priors (densities) after applying transformations to enforce parameter range constraints.

#### simulations ####
* *RLDDM_modSims_sepParam.R*: simulate new data set given set of parameters for all subjects. Used for posterior predictive checks.
* *RLDDM_modSims_sepParam_flat.R*: simulate new data set given set of parameters for single subject. Used for parameter recovery and model recovery.
* *run_simulations.R*: Simulate nIter new data sets for posterior predictive checks.
* *test_simulations.R*: Test whether code for running simulations runs.

## Task folder ##

Contains the code and files necessary to run the task in PsychoPy.

- *MGNGStakes_Task_final.py*: script to execute task.
- *DataOutput*: target directory to store behavioral output data.
- *Instructions*: instructions stored as .png files to be loaded in task; created in file *Instructions_MGNGjohalg.pptx*.
- *TaskStimuli*: contains task stimuli (cues displayed during practice trials and actual task; all in grayscale).
- *TrialHandler*: files with input variables per trial:
    - *MGNGStakes_CreateTrialSequence.R*: script used to create individual sequence with constraints per subject ID.
    - *MGNGStakes_CreatePracticeTrials.R*: script used to create sequences for four practice trial blocks (fixed across subject IDs).
    - *stimuluslist_pract_PartX.csv*: trial sequences for four practice blocks.
    - *stimuluslist_test_stimNum_320_sub_XXX_PartX.csv*: individual trial sequences per block per subject ID.

END of file.

